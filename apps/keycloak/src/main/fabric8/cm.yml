metadata:
  annotations:
    expose.config.openfact.io/apiserver-url-key: apiserver.url
    expose.service-key.config.openfact.io/openfact: openfact.url
    expose.service-key.config.openfact.io/keycloak: keycloak.url
    expose.service-key.config.openfact.io/jenkins: jenkins.url
    expose-full.service-key.config.openfact.io/sync: sync.api.url
data:
  db.url: keycloak-db
  db.port: "5432"
  apiserver.url: http://kubernetes
  openfact.url: http://openfact
  jenkins.url: http://jenkins
  keycloak.url: http://keycloak
  sync.api.url: http://sync
  openfact-realm.json: |-
    {
      "realm": "openfact",
      "enabled": true,
      "loginTheme": "openfact",
      "privateKey": "${KEYCLOAK_PRIVATEKEY}",
      "publicKey": "${KEYCLOAK_PUBLICKEY}",
      "sslRequired": "external",
      "accessTokenLifespan" : 2592000,
      "accessTokenLifespanForImplicitFlow" : 1296000,
      "ssoSessionIdleTimeout" : 2592000,
      "accessCodeLifespanUserAction" : 36000,
      "accessCodeLifespanLogin" : 2592000,
      "ssoSessionMaxLifespan" : 2592000,
      "offlineSessionIdleTimeout" : 2592000,
      "accessCodeLifespan" : 60,
      "defaultRoles": [ "user" ],
      "clients": [
        {
          "clientId": "openfact-online-platform",
          "enabled": true,
          "standardFlowEnabled": true,
          "implicitFlowEnabled": false,
          "directAccessGrantsEnabled": true,
          "authorizationServicesEnabled" : false,
          "fullScopeAllowed": true,
          "serviceAccountsEnabled": true,
          "clientAuthenticatorType": "client-secret",
          "secret": "${KEYCLOAK_CLIENTID_SECRET}",
          "publicClient" : true,
          "adminUrl" : "",
          "baseUrl" : "",
          "redirectUris": [
            "http://localhost:8080/api/login/*",
            "${SYNC_URL}*",
            "${JENKINS_URL}/securityRealm/finishLogin",
            "${KEYCLOAK_URL}/*"
          ],
          "webOrigins": [
            "*"
          ],
          "protocolMappers": [
            {
              "name": "full name",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-full-name-mapper",
              "consentRequired": true,
              "consentText": "${fullName}",
              "config": {
                "id.token.claim": "true",
                "access.token.claim": "true"
              }
            },
            {
              "name": "given name",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": true,
              "consentText": "${givenName}",
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "firstName",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "given_name",
                "jsonType.label": "String"
              }
            },
            {
              "name": "username",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": true,
              "consentText": "${username}",
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "username",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "preferred_username",
                "jsonType.label": "String"
              }
            },
            {
              "name": "family name",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": true,
              "consentText": "${familyName}",
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "lastName",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "family_name",
                "jsonType.label": "String"
              }
            },
            {
              "name": "email",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": true,
              "consentText": "${email}",
              "config": {
                "userinfo.token.claim": "true",
                "user.attribute": "email",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "email",
                "jsonType.label": "String"
              }
            },
            {
              "name": "user id",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-property-mapper",
              "consentRequired": false,
              "config": {
                "multivalued": "false",
                "user.attribute": "id",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "userID",
                "jsonType.label": "String"
              }
            },
            {
              "name": "bio",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "consentText": "${bio}",
              "config": {
                "multivalued": "false",
                "userinfo.token.claim": "true",
                "user.attribute": "bio",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "bio",
                "jsonType.label": "String"
              }
            },
            {
              "name": "company",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "consentText": "${company}",
              "config": {
                "multivalued": "false",
                "userinfo.token.claim": "true",
                "user.attribute": "company",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "company",
                "jsonType.label": "String"
              }
            },
            {
              "name": "image url",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "consentText": "${imageURL}",
              "config": {
                "multivalued": "false",
                "userinfo.token.claim": "true",
                "user.attribute": "imageURL",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "imageURL",
                "jsonType.label": "String"
              }
            },
            {
              "name": "url",
              "protocol": "openid-connect",
              "protocolMapper": "oidc-usermodel-attribute-mapper",
              "consentRequired": false,
              "consentText": "${url}",
              "config": {
                "multivalued": "false",
                "userinfo.token.claim": "true",
                "user.attribute": "url",
                "id.token.claim": "true",
                "access.token.claim": "true",
                "claim.name": "url",
                "jsonType.label": "String"
              }
            }
          ],
          "defaultRoles": ["uma_protection"],
          "authorizationSettings" : {
            "allowRemoteResourceManagement" : true,
            "policyEnforcementMode" : "ENFORCING",
            "scopes" : [ {
              "name" : "read:space"
              }, {
              "name" : "admin:space"
            } ]
          }
        }
      ],
      "users": [{
         "username": "service-account-openfact-online-platform",
         "enabled": true,
         "totp": false,
         "emailVerified": false,
         "email": "service-account-openfact-online-platform@placeholder.org",
         "serviceAccountClientId": "openfact-online-platform",
         "credentials": [],
         "disableableCredentialTypes": [],
         "requiredActions": [],
         "realmRoles": ["offline_access", "uma_authorization"],
         "clientRoles": {
            "realm-management": ["view-users", "manage-authorization"],
            "broker": ["read-token"],
            "openfact-online-platform": ["uma_protection"],
            "account": ["manage-account", "view-profile"]
         },
         "groups": []
      }],
      "clientScopeMappings": {
        "realm-management": [
            {
                "client": "openfact-online-platform",
                "roles": ["view-users"]
            },
            {
                "client": "openfact-online-platform",
                "roles": ["manage-authorization"]
            }
        ],
        "broker": [
            {
                "client": "openfact-online-platform",
                "roles": ["read-token"]
            }
        ]
      },
      "roles" : {
        "realm" : [
          {
            "name": "user",
            "description": "Read space"
          },
          {
            "name": "admin",
            "description": "Admin space"
          }
        ]
      },
      "identityProviders": [
        {
          "alias" : "google",
          "providerId" : "google",
          "enabled": true,
          "updateProfileFirstLogin" : "true",
          "storeToken" : "true",
          "trustEmail": true,
          "addReadTokenRoleOnCreate" : true,
          "config": {
            "hideOnLoginPage": "${HIDE_GOOGLE_BTN}",
            "clientSecret": "${GOOGLE_OAUTH_CLIENT_SECRET}",
            "clientId": "${GOOGLE_OAUTH_CLIENT_ID}",
            "defaultScope": "openid profile email https://www.googleapis.com/auth/gmail.readonly",
            "useJwksUrl": "true"
          }
        },
        {
          "alias" : "microsoft",
          "providerId" : "microsoft",
          "enabled": true,
          "updateProfileFirstLogin" : "true",
          "storeToken" : "true",
          "trustEmail": true,
          "addReadTokenRoleOnCreate" : true,
          "config": {
            "hideOnLoginPage": "${HIDE_MICROSOFT_BTN}",
            "clientSecret": "${MICROSOFT_OAUTH_CLIENT_SECRET}",
            "clientId": "${MICROSOFT_OAUTH_CLIENT_ID}",
            "defaultScope": "",
            "useJwksUrl": "true"
          }
        }
      ],
      "identityProviderMappers" : [
        {
          "name" : "approved",
          "identityProviderAlias" : "google",
          "identityProviderMapper" : "hardcoded-attribute-idp-mapper",
          "config" : {
            "attribute.value" : "true",
            "attribute" : "approved"
          }
        }, {
          "name" : "approved",
          "identityProviderAlias" : "microsoft",
          "identityProviderMapper" : "hardcoded-attribute-idp-mapper",
          "config" : {
            "attribute.value" : "true",
            "attribute" : "approved"
          }
        }
      ]
    }
