metadata:
  annotations:
    expose.config.openfact.io/apiserver-url-key: apiserver.url
    expose.service-key.config.openfact.io/openfact: openfact.url
    expose.service-key.config.openfact.io/keycloak: keycloak.url
    expose.service-key.config.openfact.io/jenkins: jenkins.url
    expose-full.service-key.config.openfact.io/sync: sync.api.url
data:
  db.url: keycloak-db
  db.port: "5432"
  apiserver.url: http://kubernetes
  openfact.url: http://openfact
  jenkins.url: http://jenkins
  keycloak.url: http://keycloak
  sync.api.url: http://sync
  openfact-realm.json: |-
    {
      "realm": "openfact",
      "enabled": true,
      "loginTheme": "openfact",
      "privateKey": "${KEYCLOAK_PRIVATEKEY}",
      "publicKey": "${KEYCLOAK_PUBLICKEY}",
      "sslRequired": "external",
      "accessTokenLifespan" : 2592000,
      "accessTokenLifespanForImplicitFlow" : 1296000,
      "ssoSessionIdleTimeout" : 2592000,
      "accessCodeLifespanUserAction" : 36000,
      "accessCodeLifespanLogin" : 2592000,
      "ssoSessionMaxLifespan" : 2592000,
      "offlineSessionIdleTimeout" : 2592000,
      "accessCodeLifespan" : 60,
      "defaultRoles": [ "user" ],
      "requiredActions": [
        {
          "alias": "CONFIGURE_TOTP",
          "name": "Configure OTP",
          "providerId": "CONFIGURE_TOTP",
          "enabled": true,
          "defaultAction": false,
          "config": {}
        },
        {
          "alias": "UPDATE_PASSWORD",
          "name": "Update Password",
          "providerId": "UPDATE_PASSWORD",
          "enabled": true,
          "defaultAction": false,
          "config": {}
        },
        {
          "alias": "UPDATE_PROFILE",
          "name": "Update Profile",
          "providerId": "UPDATE_PROFILE",
          "enabled": true,
          "defaultAction": true,
          "config": {}
        },
        {
          "alias": "VERIFY_EMAIL",
          "name": "Verify Email",
          "providerId": "VERIFY_EMAIL",
          "enabled": true,
          "defaultAction": false,
          "config": {}
        },
        {
          "alias": "terms_and_conditions",
          "name": "Terms and Conditions",
          "providerId": "terms_and_conditions",
          "enabled": false,
          "defaultAction": false,
          "config": {}
        }
      ],
      "clients": [
        {
          "clientId": "openfact-public-client",
          "enabled": true,
          "adminUrl": "",
          "baseUrl": "",
          "publicClient": true,
          "consentRequired" : true,
          "fullScopeAllowed" : true,
          "redirectUris": [
            "http://localhost:3000/*",
            "${OPENFACT_URL}/*"
          ],
          "webOrigins": [
            "*"
          ]
        },
        {
          "clientId": "openfact-online-platform",
          "enabled": true,
          "adminUrl" : "${OPENFACT_URL}",
          "baseUrl": "${OPENFACT_URL}",
          "bearerOnly": true
        }
      ],
      "users": [{
         "username": "service-account-openfact-online-platform",
         "enabled": true,
         "totp": false,
         "emailVerified": false,
         "email": "service-account-openfact-online-platform@placeholder.org",
         "serviceAccountClientId": "openfact-online-platform",
         "credentials": [],
         "disableableCredentialTypes": [],
         "requiredActions": [],
         "realmRoles": ["offline_access", "uma_authorization"],
         "clientRoles": {
            "realm-management": ["view-users", "manage-authorization"],
            "broker": ["read-token"],
            "openfact-online-platform": ["uma_protection"],
            "account": ["manage-account", "view-profile"]
         },
         "groups": []
      }],
      "clientScopeMappings": {
        "realm-management": [
            {
                "client": "openfact-online-platform",
                "roles": ["view-users"]
            },
            {
                "client": "openfact-online-platform",
                "roles": ["manage-authorization"]
            }
        ],
        "broker": [
            {
                "client": "openfact-online-platform",
                "roles": ["read-token"]
            }
        ]
      },
      "roles" : {
        "realm" : [
          {
            "name": "user",
            "description": "Read space"
          },
          {
            "name": "admin",
            "description": "Admin space"
          }
        ]
      },
      "identityProviders": [
        {
          "alias" : "google",
          "providerId" : "google",
          "enabled": true,
          "updateProfileFirstLogin" : "true",
          "storeToken" : "true",
          "trustEmail": true,
          "addReadTokenRoleOnCreate" : true,
          "config": {
            "hideOnLoginPage": "${HIDE_GOOGLE_BTN}",
            "clientSecret": "${GOOGLE_OAUTH_CLIENT_SECRET}",
            "clientId": "${GOOGLE_OAUTH_CLIENT_ID}",
            "defaultScope": "",
            "useJwksUrl": "true"
          }
        },
        {
          "alias" : "microsoft",
          "providerId" : "microsoft",
          "enabled": true,
          "updateProfileFirstLogin" : "true",
          "storeToken" : "true",
          "trustEmail": true,
          "addReadTokenRoleOnCreate" : true,
          "config": {
            "hideOnLoginPage": "${HIDE_MICROSOFT_BTN}",
            "clientSecret": "${MICROSOFT_OAUTH_CLIENT_SECRET}",
            "clientId": "${MICROSOFT_OAUTH_CLIENT_ID}",
            "defaultScope": "",
            "useJwksUrl": "true"
          }
        }
      ],
      "identityProviderMappers" : [
        {
          "name" : "approved",
          "identityProviderAlias" : "google",
          "identityProviderMapper" : "hardcoded-attribute-idp-mapper",
          "config" : {
            "attribute.value" : "true",
            "attribute" : "approved"
          }
        }, {
          "name" : "approved",
          "identityProviderAlias" : "microsoft",
          "identityProviderMapper" : "hardcoded-attribute-idp-mapper",
          "config" : {
            "attribute.value" : "true",
            "attribute" : "approved"
          }
        }
      ]
    }
